import "../base.api"

type (
    // The response data of Casbin rule information | Casbinæƒé™è§„åˆ™ä¿¡æ¯
    CasbinRuleInfo {
        BaseIDInfo

        // Tenant ID | ç§Ÿæˆ·ID
        TenantId *uint64 `json:"tenantId,optional"`

        // Policy type: p, g, g2, etc. | ç­–ç•¥ç±»å‹: p, g, g2ç­‰
        Ptype string `json:"ptype" validate:"required,max=10"`

        // Subject: user ID, role code | ä¸»ä½“: ç”¨æˆ·IDã€è§’è‰²ä»£ç 
        V0 *string `json:"v0,optional" validate:"omitempty,max=100"`

        // Object: resource path, API endpoint | èµ„æº: èµ„æºè·¯å¾„ã€APIç«¯ç‚¹
        V1 *string `json:"v1,optional" validate:"omitempty,max=100"`

        // Action: read, write, delete, etc. | æ“ä½œ: read, write, deleteç­‰
        V2 *string `json:"v2,optional" validate:"omitempty,max=50"`

        // Effect: allow, deny | æ•ˆæœ: allow, deny
        V3 *string `json:"v3,optional" validate:"omitempty,max=50"`

        // Condition expression: JSON format | æ¡ä»¶è¡¨è¾¾å¼: JSONæ ¼å¼
        V4 *string `json:"v4,optional" validate:"omitempty,max=500"`

        // Priority: numeric string | ä¼˜å…ˆçº§: æ•°å€¼å­—ç¬¦ä¸²
        V5 *string `json:"v5,optional" validate:"omitempty,max=20"`

        // Service name: core, cmdb, workflow, etc. | æœåŠ¡åç§°: core, cmdb, workflowç­‰
        ServiceName string `json:"serviceName" validate:"required,max=50"`

        // Rule name: for identification | è§„åˆ™åç§°: ä¾¿äºè¯†åˆ«
        RuleName *string `json:"ruleName,optional" validate:"omitempty,max=100"`

        // Rule description | è§„åˆ™æè¿°
        Description *string `json:"description,optional" validate:"omitempty,max=500"`

        // Rule category: system, business, custom | è§„åˆ™åˆ†ç±»: system, business, custom
        Category *string `json:"category,optional" validate:"omitempty,max=50"`

        // Rule version | è§„åˆ™ç‰ˆæœ¬
        Version *string `json:"version,optional" validate:"omitempty,max=20"`

        // Require approval | æ˜¯å¦éœ€è¦å®¡æ‰¹
        RequireApproval *bool `json:"requireApproval,optional"`

        // Approval status: pending, approved, rejected | å®¡æ‰¹çŠ¶æ€: pending, approved, rejected
        ApprovalStatus *string `json:"approvalStatus,optional" validate:"omitempty,max=20"`

        // Approved by user ID | å®¡æ‰¹äººID
        ApprovedBy *uint64 `json:"approvedBy,optional"`

        // Approval time | å®¡æ‰¹æ—¶é—´
        ApprovedAt *int64 `json:"approvedAt,optional"`

        // Effective from time | ç”Ÿæ•ˆå¼€å§‹æ—¶é—´
        EffectiveFrom *int64 `json:"effectiveFrom,optional"`

        // Effective to time | ç”Ÿæ•ˆç»“æŸæ—¶é—´
        EffectiveTo *int64 `json:"effectiveTo,optional"`

        // Is temporary permission | æ˜¯å¦ä¸ºä¸´æ—¶æƒé™
        IsTemporary *bool `json:"isTemporary,optional"`

        // Status | è§„åˆ™çŠ¶æ€
        Status *uint32 `json:"status,optional" validate:"omitempty,lt=20"`

        // Metadata JSON string | å…ƒæ•°æ®JSONå­—ç¬¦ä¸²
        Metadata *string `json:"metadata,optional" validate:"omitempty,max=1000"`

        // Tags list | æ ‡ç­¾åˆ—è¡¨
        Tags []string `json:"tags,optional"`

        // Usage count | ä½¿ç”¨æ¬¡æ•°ç»Ÿè®¡
        UsageCount *int64 `json:"usageCount,optional"`

        // Last used time | æœ€åä½¿ç”¨æ—¶é—´
        LastUsedAt *int64 `json:"lastUsedAt,optional"`
    }

    // Get Casbin rule list request params | Casbinè§„åˆ™åˆ—è¡¨è¯·æ±‚å‚æ•°
    CasbinRuleListReq {
        PageInfo

        // Service name filter | æŒ‰æœåŠ¡åç§°è¿‡æ»¤
        ServiceName *string `json:"serviceName,optional" validate:"omitempty,max=50"`

        // Policy type filter | æŒ‰ç­–ç•¥ç±»å‹è¿‡æ»¤
        Ptype *string `json:"ptype,optional" validate:"omitempty,max=10"`

        // Subject filter | æŒ‰ä¸»ä½“è¿‡æ»¤
        V0 *string `json:"v0,optional" validate:"omitempty,max=100"`

        // Object filter | æŒ‰èµ„æºè¿‡æ»¤
        V1 *string `json:"v1,optional" validate:"omitempty,max=100"`

        // Status filter | æŒ‰çŠ¶æ€è¿‡æ»¤
        Status *uint32 `json:"status,optional" validate:"omitempty,lt=20"`

        // Approval status filter | æŒ‰å®¡æ‰¹çŠ¶æ€è¿‡æ»¤
        ApprovalStatus *string `json:"approvalStatus,optional" validate:"omitempty,max=20"`

        // Category filter | æŒ‰åˆ†ç±»è¿‡æ»¤
        Category *string `json:"category,optional" validate:"omitempty,max=50"`

        // Temporary permission filter | æŒ‰ä¸´æ—¶æƒé™è¿‡æ»¤
        IsTemporary *bool `json:"isTemporary,optional"`

        // Effective time range start | ç”Ÿæ•ˆæ—¶é—´èŒƒå›´å¼€å§‹
        EffectiveFromStart *int64 `json:"effectiveFromStart,optional"`

        // Effective time range end | ç”Ÿæ•ˆæ—¶é—´èŒƒå›´ç»“æŸ
        EffectiveFromEnd *int64 `json:"effectiveFromEnd,optional"`

        // Search keyword | å…³é”®è¯æœç´¢(è§„åˆ™åç§°ã€æè¿°)
        Keyword *string `json:"keyword,optional" validate:"omitempty,max=100"`

        // Order by field | æ’åºå­—æ®µ
        OrderBy *string `json:"orderBy,optional" validate:"omitempty,max=50"`

        // Order direction: asc, desc | æ’åºæ–¹å‘: asc, desc
        OrderDirection *string `json:"orderDirection,optional" validate:"omitempty,oneof=asc desc"`
    }

    // Casbin rule list data | Casbinè§„åˆ™åˆ—è¡¨æ•°æ®
    CasbinRuleListInfo {
        BaseListInfo

        // The Casbin rule list data | Casbinè§„åˆ™åˆ—è¡¨æ•°æ®
        Data []CasbinRuleInfo `json:"data"`
    }

    // The response data of Casbin rule list | Casbinè§„åˆ™åˆ—è¡¨æ•°æ®
    CasbinRuleListResp {
        BaseDataInfo

        // Casbin rule list data | Casbinè§„åˆ™åˆ—è¡¨æ•°æ®
        Data CasbinRuleListInfo `json:"data"`
    }

    // Casbin rule information response | Casbinè§„åˆ™ä¿¡æ¯è¿”å›ä½“
    CasbinRuleInfoResp {
        BaseDataInfo

        // Casbin rule information | Casbinè§„åˆ™æ•°æ®
        Data CasbinRuleInfo `json:"data"`
    }

    // Batch create Casbin rules request | æ‰¹é‡åˆ›å»ºCasbinè§„åˆ™è¯·æ±‚
    BatchCreateCasbinRulesReq {
        // Rules list | è§„åˆ™åˆ—è¡¨
        Rules []CasbinRuleInfo `json:"rules" validate:"required,dive"`
    }

    // Batch update Casbin rules request | æ‰¹é‡æ›´æ–°Casbinè§„åˆ™è¯·æ±‚
    BatchUpdateCasbinRulesReq {
        // Rules list | è§„åˆ™åˆ—è¡¨
        Rules []CasbinRuleInfo `json:"rules" validate:"required,dive"`
    }

    // Permission check request | æƒé™æ£€æŸ¥è¯·æ±‚
    PermissionCheckReq {
        // Service name | æœåŠ¡åç§°
        ServiceName string `json:"serviceName" validate:"required,max=50"`

        // Subject: user ID or role | ä¸»ä½“: ç”¨æˆ·IDæˆ–è§’è‰²
        Subject string `json:"subject" validate:"required,max=100"`

        // Object: resource path | èµ„æº: èµ„æºè·¯å¾„
        Object string `json:"object" validate:"required,max=100"`

        // Action: operation type | æ“ä½œ: æ“ä½œç±»å‹
        Action string `json:"action" validate:"required,max=50"`

        // Context information | ä¸Šä¸‹æ–‡ä¿¡æ¯
        Context map[string]string `json:"context,optional"`

        // Enable cache | æ˜¯å¦å¯ç”¨ç¼“å­˜
        EnableCache *bool `json:"enableCache,optional"`

        // Audit log | æ˜¯å¦è®°å½•å®¡è®¡æ—¥å¿—
        AuditLog *bool `json:"auditLog,optional"`
    }

    // Permission check response | æƒé™æ£€æŸ¥å“åº”
    PermissionCheckResp {
        BaseDataInfo

        // Permission check result | æƒé™æ£€æŸ¥ç»“æœ
        Data PermissionCheckResult `json:"data"`
    }

    // Permission check result | æƒé™æ£€æŸ¥ç»“æœ
    PermissionCheckResult {
        // Is allowed | æ˜¯å¦å…è®¸
        Allowed bool `json:"allowed"`

        // Reason | åŸå› è¯´æ˜
        Reason string `json:"reason"`

        // Applied rules | åº”ç”¨çš„è§„åˆ™IDåˆ—è¡¨
        AppliedRules []string `json:"appliedRules"`

        // Data filters | æ•°æ®è¿‡æ»¤æ¡ä»¶
        DataFilters map[string]string `json:"dataFilters"`

        // Field masks | å­—æ®µæ©ç åˆ—è¡¨
        FieldMasks []string `json:"fieldMasks"`

        // Check duration in milliseconds | æ£€æŸ¥è€—æ—¶(æ¯«ç§’)
        CheckDurationMs int64 `json:"checkDurationMs"`

        // From cache | æ˜¯å¦æ¥è‡ªç¼“å­˜
        FromCache bool `json:"fromCache"`
    }

    // Batch permission check request | æ‰¹é‡æƒé™æ£€æŸ¥è¯·æ±‚
    BatchPermissionCheckReq {
        // Permission requests | æƒé™è¯·æ±‚åˆ—è¡¨
        Requests []PermissionCheckReq `json:"requests" validate:"required,dive"`

        // Fail fast | æ˜¯å¦å¿«é€Ÿå¤±è´¥
        FailFast *bool `json:"failFast,optional"`
    }

    // Batch permission check response | æ‰¹é‡æƒé™æ£€æŸ¥å“åº”
    BatchPermissionCheckResp {
        BaseDataInfo

        // Batch check result | æ‰¹é‡æ£€æŸ¥ç»“æœ
        Data BatchPermissionCheckResult `json:"data"`
    }

    // Batch permission check result | æ‰¹é‡æƒé™æ£€æŸ¥ç»“æœ
    BatchPermissionCheckResult {
        // Permission responses | æƒé™å“åº”åˆ—è¡¨
        Responses []PermissionCheckResult `json:"responses"`

        // Success count | æˆåŠŸæ•°é‡
        SuccessCount int32 `json:"successCount"`

        // Failed count | å¤±è´¥æ•°é‡
        FailedCount int32 `json:"failedCount"`
    }

    // Get user permission summary request | è·å–ç”¨æˆ·æƒé™æ‘˜è¦è¯·æ±‚
    UserPermissionSummaryReq {
        // User ID | ç”¨æˆ·ID
        UserId string `json:"userId" validate:"required,max=100"`

        // Service name | æœåŠ¡åç§°
        ServiceName *string `json:"serviceName,optional" validate:"omitempty,max=50"`

        // Include inherited permissions | æ˜¯å¦åŒ…å«ç»§æ‰¿æƒé™
        IncludeInherited *bool `json:"includeInherited,optional"`
    }

    // User permission summary response | ç”¨æˆ·æƒé™æ‘˜è¦å“åº”
    UserPermissionSummaryResp {
        BaseDataInfo

        // Permission summary | æƒé™æ‘˜è¦æ•°æ®
        Data UserPermissionSummary `json:"data"`
    }

    // User permission summary | ç”¨æˆ·æƒé™æ‘˜è¦
    UserPermissionSummary {
        // User ID | ç”¨æˆ·ID
        UserId string `json:"userId"`

        // Permissions | æƒé™åˆ—è¡¨
        Permissions []PermissionSummary `json:"permissions"`

        // Total count | æ€»æ•°é‡
        TotalCount int32 `json:"totalCount"`
    }

    // Permission summary | æƒé™æ‘˜è¦ä¿¡æ¯
    PermissionSummary {
        // Resource | èµ„æº
        Resource string `json:"resource"`

        // Actions | æ“ä½œåˆ—è¡¨
        Actions []string `json:"actions"`

        // Source: direct, inherited | æƒé™æ¥æº: direct, inherited
        Source string `json:"source"`

        // Rule ID | è§„åˆ™ID
        RuleId *string `json:"ruleId,optional"`
    }

    // Validate Casbin rule request | æƒé™è§„åˆ™éªŒè¯è¯·æ±‚
    ValidateCasbinRuleReq {
        // Rule to validate | å¾…éªŒè¯çš„è§„åˆ™
        Rule CasbinRuleInfo `json:"rule" validate:"required"`

        // Check conflicts | æ˜¯å¦æ£€æŸ¥å†²çª
        CheckConflicts *bool `json:"checkConflicts,optional"`
    }

    // Validate Casbin rule response | æƒé™è§„åˆ™éªŒè¯å“åº”
    ValidateCasbinRuleResp {
        BaseDataInfo

        // Validation result | éªŒè¯ç»“æœ
        Data ValidationResult `json:"data"`
    }

    // Validation result | éªŒè¯ç»“æœ
    ValidationResult {
        // Is valid | æ˜¯å¦æœ‰æ•ˆ
        Valid bool `json:"valid"`

        // Validation errors | éªŒè¯é”™è¯¯åˆ—è¡¨
        Errors []string `json:"errors"`

        // Warning messages | è­¦å‘Šä¿¡æ¯åˆ—è¡¨
        Warnings []string `json:"warnings"`

        // Conflict rule IDs | å†²çªè§„åˆ™IDåˆ—è¡¨
        Conflicts []string `json:"conflicts"`
    }

    // Sync Casbin rules request | è§„åˆ™åŒæ­¥è¯·æ±‚
    SyncCasbinRulesReq {
        // Service name filter | åŒæ­¥æŒ‡å®šæœåŠ¡çš„è§„åˆ™ï¼Œä¸ºç©ºåˆ™åŒæ­¥æ‰€æœ‰
        ServiceName *string `json:"serviceName,optional" validate:"omitempty,max=50"`

        // Force reload | æ˜¯å¦å¼ºåˆ¶é‡æ–°åŠ è½½
        ForceReload *bool `json:"forceReload,optional"`
    }

    // Sync Casbin rules response | è§„åˆ™åŒæ­¥å“åº”
    SyncCasbinRulesResp {
        BaseDataInfo

        // Sync result | åŒæ­¥ç»“æœ
        Data SyncResult `json:"data"`
    }

    // Sync result | åŒæ­¥ç»“æœ
    SyncResult {
        // Synced count | åŒæ­¥çš„è§„åˆ™æ•°é‡
        SyncedCount int32 `json:"syncedCount"`

        // Synced services | åŒæ­¥çš„æœåŠ¡åˆ—è¡¨
        SyncedServices []string `json:"syncedServices"`

        // Sync duration in milliseconds | åŒæ­¥è€—æ—¶
        SyncDurationMs int64 `json:"syncDurationMs"`
    }

    // Refresh Casbin cache request | åˆ·æ–°ç¼“å­˜è¯·æ±‚
    RefreshCasbinCacheReq {
        // Cache type: rule, decision, all | ç¼“å­˜ç±»å‹: rule, decision, all
        CacheType *string `json:"cacheType,optional" validate:"omitempty,oneof=rule decision all"`

        // Service name | æŒ‡å®šæœåŠ¡
        ServiceName *string `json:"serviceName,optional" validate:"omitempty,max=50"`
    }

    // Refresh Casbin cache response | åˆ·æ–°ç¼“å­˜å“åº”
    RefreshCasbinCacheResp {
        BaseDataInfo

        // Refresh result | åˆ·æ–°ç»“æœ
        Data RefreshCacheResult `json:"data"`
    }

    // Refresh cache result | åˆ·æ–°ç¼“å­˜ç»“æœ
    RefreshCacheResult {
        // Success | æ˜¯å¦æˆåŠŸ
        Success bool `json:"success"`

        // Message | æ¶ˆæ¯
        Message string `json:"message"`

        // Cleared entries | æ¸…ç†çš„ç¼“å­˜æ¡ç›®æ•°
        ClearedEntries int32 `json:"clearedEntries"`
    }
)

// ğŸ”¥ éµå¾ªCLAUDE.mdè§„èŒƒ - ä¸­é—´ä»¶å…¨å±€æ³¨å†Œ
@server(
    group: casbin
)

service Core {
    // === æƒé™è§„åˆ™ç®¡ç† CRUD ===
    
    // Create Casbin rule | åˆ›å»ºæƒé™è§„åˆ™
    @handler createCasbinRule
    post /casbin/rules (CasbinRuleInfo) returns (BaseMsgResp)

    // Update Casbin rule | æ›´æ–°æƒé™è§„åˆ™
    @handler updateCasbinRule
    put /casbin/rules (CasbinRuleInfo) returns (BaseMsgResp)

    // Delete Casbin rule | åˆ é™¤æƒé™è§„åˆ™
    @handler deleteCasbinRule
    delete /casbin/rules (IDsReq) returns (BaseMsgResp)

    // Get Casbin rule list | è·å–æƒé™è§„åˆ™åˆ—è¡¨
    @handler getCasbinRuleList
    post /casbin/rules/list (CasbinRuleListReq) returns (CasbinRuleListResp)

    // Get Casbin rule by ID | æ ¹æ®IDè·å–æƒé™è§„åˆ™
    @handler getCasbinRuleById
    post /casbin/rules/detail (IDReq) returns (CasbinRuleInfoResp)

    // === æ‰¹é‡æ“ä½œ ===
    
    // Batch create Casbin rules | æ‰¹é‡åˆ›å»ºæƒé™è§„åˆ™
    @handler batchCreateCasbinRules
    post /casbin/rules/batch/create (BatchCreateCasbinRulesReq) returns (BaseMsgResp)

    // Batch update Casbin rules | æ‰¹é‡æ›´æ–°æƒé™è§„åˆ™
    @handler batchUpdateCasbinRules
    put /casbin/rules/batch/update (BatchUpdateCasbinRulesReq) returns (BaseMsgResp)

    // Batch delete Casbin rules | æ‰¹é‡åˆ é™¤æƒé™è§„åˆ™
    @handler batchDeleteCasbinRules
    delete /casbin/rules/batch/delete (IDsReq) returns (BaseMsgResp)

    // === æƒé™éªŒè¯ ===
    
    // Check permission | æƒé™æ£€æŸ¥
    @handler checkPermission
    post /casbin/permission/check (PermissionCheckReq) returns (PermissionCheckResp)

    // Batch check permission | æ‰¹é‡æƒé™æ£€æŸ¥
    @handler batchCheckPermission
    post /casbin/permission/batch/check (BatchPermissionCheckReq) returns (BatchPermissionCheckResp)

    // === æƒé™æŸ¥è¯¢ ===
    
    // Get user permission summary | è·å–ç”¨æˆ·æƒé™æ‘˜è¦
    @handler getUserPermissionSummary
    post /casbin/permission/summary (UserPermissionSummaryReq) returns (UserPermissionSummaryResp)

    // === è§„åˆ™éªŒè¯ ===
    
    // Validate Casbin rule | éªŒè¯æƒé™è§„åˆ™
    @handler validateCasbinRule
    post /casbin/rules/validate (ValidateCasbinRuleReq) returns (ValidateCasbinRuleResp)

    // === ç³»ç»Ÿç®¡ç† ===
    
    // Sync Casbin rules | åŒæ­¥æƒé™è§„åˆ™
    @handler syncCasbinRules
    post /casbin/system/sync (SyncCasbinRulesReq) returns (SyncCasbinRulesResp)

    // Refresh Casbin cache | åˆ·æ–°æƒé™ç¼“å­˜
    @handler refreshCasbinCache
    post /casbin/system/cache/refresh (RefreshCasbinCacheReq) returns (RefreshCasbinCacheResp)
}